---
title: "Application Architecture Overview"
---

ComfyUI uses a modular, extensible architecture that allows developers to create custom functionality while maintaining compatibility with the core application. This document provides a high-level overview of the application architecture from an extension developer's perspective.

## Core Architecture Components

![Application Architecture](/images/app_architecture.png)

The ComfyUI frontend consists of these key components:

### ComfyApp
The central application controller that coordinates between different parts of the system. For extension developers, this is accessed via the global `app` object.

### Graph Canvas
The visual editor where nodes are created and connected. Built on an extended version of LiteGraph.js, this component handles the visual representation and interaction with workflows.

### API Service
Manages communication with the backend server via WebSockets and REST API calls. Available through `app.api`.

### Extension Manager
Handles registration and management of extensions, providing hooks into the application. Available through `app.extensionManager`.

### Stores
Reactive state stores for different aspects of the application (settings, commands, nodes, etc.). Most are accessible through appropriate APIs on `app` and `app.extensionManager`.

## Extension Integration Points

Extensions can integrate with ComfyUI at multiple points:

### 1. Node System

Extensions can register custom nodes, modify existing node definitions, and add custom widgets:

```javascript
app.registerExtension({
  name: "CustomNodesExample",
  // Called before a node type is registered
  async beforeRegisterNodeDef(nodeType, nodeData) {
    // Modify node appearance or behavior
  },
  
  // Register custom nodes
  async registerCustomNodes() {
    // Register custom node types
  },
  
  // Add custom widgets
  async getCustomWidgets() {
    return {
      // Custom widget definitions
    };
  }
});
```

### 2. User Interface

Extensions can extend the user interface with:
- Custom sidebar tabs
- Bottom panel tabs
- Dialog boxes and toast notifications
- About panel badges
- Menu items

```javascript
app.registerExtension({
  name: "UIExtensionExample",
  // Add custom UI elements
  async setup() {
    // Register a sidebar tab
    app.extensionManager.registerSidebarTab({
      // Tab configuration
    });
    
    // Show toast message
    app.extensionManager.toast.add({
      // Toast configuration
    });
  }
});
```

### 3. Commands and Keybindings

Extensions can add custom commands and associate them with keyboard shortcuts:

```javascript
app.registerExtension({
  name: "CommandsExample",
  // Register commands
  commands: [
    // Command definitions
  ],
  
  // Register keybindings
  keybindings: [
    // Keybinding configurations
  ]
});
```

### 4. Settings

Extensions can add configuration options accessible through the settings panel:

```javascript
app.registerExtension({
  name: "SettingsExample",
  // Register settings
  settings: [
    // Setting definitions
  ]
});
```

### 5. Event Handling

Extensions can respond to application events:

```javascript
app.registerExtension({
  name: "EventHandlingExample",
  // Set up event listeners
  async setup() {
    // Listen for API events
    app.api.addEventListener("execution_start", () => {
      // Handle event
    });
    
    // Listen for graph events
    app.graph.addEventListener("noderemoved", () => {
      // Handle event
    });
  }
});
```

## Extension Lifecycle

Extensions go through several lifecycle hooks:

1. **Registration**: When `app.registerExtension()` is called
2. **Initialization**: The `init()` hook is called during application startup
3. **Node Registration**: Hooks for customizing and adding nodes are called
4. **Setup**: The `setup()` hook is called when the application is fully initialized
5. **Ongoing Events**: Extensions respond to events during application usage

## State Management

ComfyUI uses reactive state management through several key stores:

- **SettingStore**: Manages application and extension settings
- **CommandStore**: Registers and executes commands
- **NodeDefStore**: Manages node definitions and search
- **GraphStore**: Handles the workflow graph state

Most stores are not accessed directly, but rather through appropriate APIs on the `app` object.

## Best Practices for Extension Development

1. **Use Available APIs**: Work with the provided extension points rather than directly modifying core internals.

2. **Follow Hook Patterns**: Use the appropriate lifecycle hooks for your functionality.

3. **Clean Up Resources**: If your extension allocates resources or adds event listeners, make sure to clean them up when appropriate.

4. **Respect User Settings**: Check and honor user settings before making intrusive changes.

5. **Be Compatible**: Test your extension with other popular extensions to ensure compatibility.

By understanding the architecture of ComfyUI, you can develop extensions that integrate well with the core application and provide a seamless experience for users.

## Related Documentation

- [JavaScript Overview](/custom-nodes/js/javascript_overview)
- [Client-Server Communication](/custom-nodes/js/javascript_client_server_architecture)
- [Extension Debugging and Performance](/custom-nodes/js/javascript_debugging)
- [Widget Customization](/custom-nodes/js/javascript_widget_customization)
- [Extension Examples](/custom-nodes/js/javascript_extension_examples)