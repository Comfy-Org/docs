---
title: "Client-Server Communication Architecture"
---

Understanding how ComfyUI's frontend and backend communicate is essential for extension developers who need to interact with the server, respond to events, or add custom functionality that spans both sides of the application.

## Communication Overview

ComfyUI uses a hybrid communication approach:
- **WebSocket** for real-time events and updates
- **REST API** for specific operations and data fetching

![Client-Server Communication Architecture](/images/communication_architecture.png)

## WebSocket Communication

The WebSocket connection is used for real-time events like:
- Execution status updates
- Progress notifications
- Node execution results
- System status changes

### Listening for WebSocket Events

```javascript
app.registerExtension({
  name: "WebSocketListenerExample",
  setup() {
    // Listen for execution start
    app.api.addEventListener("execution_start", (event) => {
      console.log("Workflow execution started:", event);
    });
    
    // Listen for progress updates
    app.api.addEventListener("progress", (event) => {
      const progress = event.detail;
      console.log(`Node ${progress.node} progress: ${progress.value}%`);
    });
    
    // Listen for execution completion
    app.api.addEventListener("execution_success", (event) => {
      console.log("Execution completed successfully!");
    });
    
    // Listen for execution errors
    app.api.addEventListener("execution_error", (event) => {
      console.error("Execution error:", event.detail);
    });
  }
});
```

### Available WebSocket Events

| Event Name | Description | Event Detail |
|------------|-------------|--------------|
| `execution_start` | Workflow execution has started | Execution data |
| `execution_success` | Workflow executed successfully | Execution result |
| `execution_error` | Error during workflow execution | Error details |
| `progress` | Progress update for node execution | Progress data |
| `executing` | Node is currently executing | Node ID and type |
| `executed` | Node has been executed | Node output data |
| `status` | Server status update | Status information |
| `reconnecting` | WebSocket is reconnecting | None |
| `reconnected` | WebSocket has reconnected | None |

## REST API Communication

The REST API is used for operations like:
- Uploading files
- Queuing prompts for execution
- Managing workflows
- Fetching system information

### Common API Operations

```javascript
app.registerExtension({
  name: "APIExample",
  async setup() {
    // Queue a prompt for execution
    const promptResult = await app.api.queuePrompt(promptData);
    
    // Get a list of available models
    const modelsInfo = await app.api.getModels();
    
    // Check server status
    const systemInfo = await app.api.getSystemStats();
  }
});
```

## Frontend-Triggered Events

When the frontend performs certain actions, it also fires events that extensions can listen for:

```javascript
app.registerExtension({
  name: "FrontendEventsExample",
  setup() {
    // Graph was changed
    app.api.addEventListener("graphChanged", (event) => {
      const workflow = event.detail;
      console.log("Workflow updated:", workflow);
    });
    
    // Prompt was queued
    app.api.addEventListener("promptQueued", (event) => {
      const queueData = event.detail;
      console.log(`Prompt queued at position ${queueData.number}`);
    });
    
    // Graph was cleared
    app.api.addEventListener("graphCleared", () => {
      console.log("Graph was cleared");
    });
  }
});
```

## Extension Communication Best Practices

1. **Use the API Layer**: Always use the `app.api` methods rather than making direct fetch/WebSocket calls.

2. **Clean Up Event Listeners**: If your extension adds event listeners in hooks like `setup()`, make sure to remove them when appropriate to avoid memory leaks.

3. **Handle Reconnection**: Be prepared for WebSocket disconnections by listening for the `reconnecting` and `reconnected` events.

4. **Respect Queue Position**: When queuing prompts, respect the user's place in the execution queue.

5. **Validate API Responses**: Always validate responses from the API and handle errors gracefully.

By understanding the communication architecture of ComfyUI, you can create extensions that effectively interact with both the client and server components of the application.

## Related Documentation

- [JavaScript Overview](/custom-nodes/js/javascript_overview)
- [JavaScript Hooks](/custom-nodes/js/javascript_hooks)
- [JavaScript Settings](/custom-nodes/js/javascript_settings)
- [Application Architecture](/custom-nodes/js/javascript_application_architecture)
- [Extension Debugging and Performance](/custom-nodes/js/javascript_debugging)