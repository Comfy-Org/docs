---
title: 'Extension Debugging and Performance'  
description: 'Best practices for debugging ComfyUI extensions and optimizing performance'  
---

# Extension Debugging and Performance

This guide provides practical techniques for debugging ComfyUI extensions and improving their performance. By following these best practices, you can create more reliable and efficient extensions.

## Built-in Debugging Tools

### Browser Developer Tools

The browser's developer tools are your primary debugging interface:

```javascript
// Add debugging breakpoints in your code
debugger;

// Log important information
console.log('Extension initialized', myData);
console.warn('Potential issue:', problem);
console.error('Error occurred:', error);

// Time performance-critical operations
console.time('operationName');
// ... operation code ...
console.timeEnd('operationName');
```

### ComfyUI Console Output

ComfyUI outputs additional debugging information to its console:

- In Desktop apps: View logs in the Logs panel
- In browser installations: Check your browser console
- In manual installations: Review server terminal output

## Debugging Extension Registration

Problems during extension registration are common:

```javascript
// Verify your extension was registered
console.log('Extensions:', app.extensionManager._extensions);

// Check if your extension is correctly loaded
console.log('My extension:', app.extensionManager.getExtension('MyExtension'));
```

## Event Debugging

To debug issues with event listeners:

```javascript
// Add debug listener for a specific event
app.api.addEventListener('execution_start', (data) => {
  console.log('Execution started with data:', data);
});

// Check which event was triggered last
let lastEvent = null;
app.api.addEventListener('*', (eventName, data) => {
  lastEvent = { name: eventName, data };
  console.log('Event triggered:', eventName, data);
});
```

## Node and Widget Debugging

When working with nodes and widgets:

```javascript
// Inspect a specific node
const node = app.graph.findNodeByTitle('KSampler');
console.log('Node details:', node);

// Debug node widgets
console.log('Node widgets:', node.widgets);

// Track widget changes
app.registerExtension({
  name: 'WidgetDebugger',
  setup() {
    const origOnWidgetChanged = LGraphNode.prototype.onWidgetChanged;
    LGraphNode.prototype.onWidgetChanged = function(widget, oldValue, newValue) {
      console.log(`Widget changed in ${this.title}:`, widget.name, oldValue, 'â†’', newValue);
      return origOnWidgetChanged?.apply(this, arguments);
    };
  }
});
```

## Network Request Debugging

Debug API requests and WebSocket communications:

```javascript
// Monitor fetch requests
const originalFetch = window.fetch;
window.fetch = async function(...args) {
  console.log('Fetch request:', args[0], args[1]);
  return originalFetch.apply(this, args);
};

// Log WebSocket messages
app.registerExtension({
  name: 'WebSocketDebugger',
  setup() {
    const origHandleMessage = app.api.comfyUI._handleMessage;
    app.api.comfyUI._handleMessage = function(event) {
      const data = JSON.parse(event.data);
      console.log('WebSocket message received:', data);
      return origHandleMessage.call(this, event);
    };
  }
});
```

## Performance Optimization

### DOM Manipulation

Efficient DOM updates are crucial for UI performance:

```javascript
// Poor performance: Multiple DOM updates
for (let i = 0; i < 1000; i++) {
  container.appendChild(document.createElement('div'));
}

// Better performance: Batch DOM updates
const fragment = document.createDocumentFragment();
for (let i = 0; i < 1000; i++) {
  fragment.appendChild(document.createElement('div'));
}
container.appendChild(fragment);
```

### Event Listener Management

Properly manage event listeners to prevent memory leaks:

```javascript
// Store references to listeners
const myListeners = [];

app.registerExtension({
  name: 'CleanExtension',
  setup() {
    const listener = (data) => {
      console.log('Event data:', data);
    };
    
    app.api.addEventListener('execution_start', listener);
    myListeners.push({ event: 'execution_start', callback: listener });
  },
  unload() {
    // Clean up all listeners when extension unloads
    myListeners.forEach(({ event, callback }) => {
      app.api.removeEventListener(event, callback);
    });
    myListeners.length = 0;
  }
});
```

### Expensive Calculations

Optimize performance for computationally expensive operations:

```javascript
// Cache results of expensive operations
const resultCache = new Map();

function expensiveOperation(input) {
  if (resultCache.has(input)) {
    return resultCache.get(input);
  }
  
  // Perform expensive calculation
  const result = /* ...calculation... */;
  
  resultCache.set(input, result);
  return result;
}

// Debounce frequent updates
function debounce(func, wait) {
  let timeout;
  return function(...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), wait);
  };
}

const updateUI = debounce(() => {
  // Expensive UI update
}, 250);
```

## Common Debugging Issues

### Extension Not Loading

If your extension isn't loading properly:

1. Check the console for JavaScript errors
2. Verify your extension is registered correctly
3. Ensure all required dependencies are loaded
4. Check that your file paths are correct

### Extension Conflicts

If your extension conflicts with others:

1. Use unique namespace and extension names
2. Avoid modifying prototypes where possible
3. Check for other extensions that might be modifying the same functionality

```javascript
// Check loaded extensions
console.log('Loaded extensions:', Object.keys(app.extensionManager._extensions));
```

### Memory Leaks

Common causes of memory leaks:

1. Uncleaned event listeners
2. Circular references
3. Storing large datasets

Use Chrome's Memory Profiler to identify potential leaks:

1. Open Developer Tools
2. Go to the Memory tab
3. Take a heap snapshot before and after operations
4. Compare snapshots to find retained objects

## Related Documentation

- [JavaScript Overview](/custom-nodes/js/javascript_overview)
- [Client-Server Architecture](/custom-nodes/js/javascript_client_server_architecture)
- [Application Architecture](/custom-nodes/js/javascript_application_architecture)
