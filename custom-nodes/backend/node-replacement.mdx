---
title: "Node replacement"
description: "Register node replacements to help users migrate from deprecated nodes"
---

The Node Replacement API allows custom node developers to define migration paths from deprecated nodes to their newer equivalents. When you update or rename nodes, users can automatically upgrade their workflows.

## Registering replacements

Use the `comfy_api.latest` module to register node replacements:

```python
from comfy_api.latest import io, ComfyAPI

api = ComfyAPI()

await api.node_replacement.register(
    io.NodeReplace(
        new_node_id="NewNodeClass",
        old_node_id="OldNodeClass",
        old_widget_ids=["old_input_name", "old_param"],
        input_mapping=[
            {"new_id": "new_input_name", "old_id": "old_input_name"},
            {"new_id": "new_param", "set_value": 512},
        ],
        output_mapping=[
            {"new_idx": 0, "old_idx": 0},
        ],
    )
)
```

## NodeReplace parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `new_node_id` | str | Class name of the replacement node |
| `old_node_id` | str | Class name of the deprecated node |
| `old_widget_ids` | list[str] \| None | Ordered list binding widget IDs to their relative indexes |
| `input_mapping` | list \| None | How to map inputs from old to new node |
| `output_mapping` | list \| None | How to map outputs from old to new node |

## Input mapping

Each input mapping entry defines how an input transfers from the old node to the new one.

**Map from old input:**
```python
{"new_id": "model", "old_id": "model"}
```

**Set a fixed value:**
```python
{"new_id": "scheduler", "set_value": "normal"}
```

## Output mapping

Output mappings use index-based references:

```python
{"new_idx": 0, "old_idx": 0}  # Map first output
{"new_idx": 1, "old_idx": 0}  # Old output 0 -> new output 1
```

## Widget ID binding

The `old_widget_ids` field maps widget IDs to their positional indexes. This is required because workflow JSON stores widget values by position, not ID.

```python
old_widget_ids=["steps", "cfg", "sampler"]
# Widget at index 0 = "steps"
# Widget at index 1 = "cfg"
# Widget at index 2 = "sampler"
```

## REST API

Retrieve all registered replacements:

```
GET /api/node_replacements
```

**Response:**
```json
{
  "OldSamplerNode": [
    {
      "new_node_id": "NewSamplerNode",
      "old_node_id": "OldSamplerNode",
      "old_widget_ids": ["num_steps", "cfg_scale", "sampler_name"],
      "input_mapping": [
        {"new_id": "model", "old_id": "model"},
        {"new_id": "steps", "old_id": "num_steps"},
        {"new_id": "scheduler", "set_value": "normal"}
      ],
      "output_mapping": [
        {"new_idx": 0, "old_idx": 0}
      ]
    }
  ]
}
```

## Use cases

- **Node migration**: Automatically upgrade user workflows when updating your custom node pack
- **API changes**: Map renamed inputs/outputs to maintain backwards compatibility
- **Default values**: Provide sensible defaults for new inputs that didn't exist on the old node
