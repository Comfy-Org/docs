---
title: "Z-Image ComfyUI å·¥ä½œæµç¤ºä¾‹"
description: "Z-Image æ˜¯ä¸€ä¸ªæ‹¥æœ‰ 6B å‚æ•°çš„é«˜æ•ˆå›¾åƒç”ŸæˆåŸºç¡€æ¨¡å‹ï¼Œé‡‡ç”¨å•æµæ‰©æ•£å˜æ¢å™¨æ¶æ„ï¼Œå¯å®ç°äºšç§’çº§æ¨ç†å»¶è¿Ÿã€‚"
sidebarTitle: "Z-Image"
---

import UpdateReminder from '/snippets/zh/tutorials/update-reminder.mdx'

**Z-Imageï¼ˆé€ ç›¸ï¼‰** æ˜¯é˜¿é‡Œå·´å·´é€šä¹‰å®éªŒå®¤å¼€å‘çš„ä¸€ä¸ªå¼ºå¤§ä¸”é«˜æ•ˆçš„å›¾åƒç”Ÿæˆæ¨¡å‹ï¼Œæ‹¥æœ‰ **6B** å‚æ•°ã€‚å®ƒé‡‡ç”¨ **å¯æ‰©å±•å•æµ DiT**ï¼ˆS3-DiTï¼‰æ¶æ„ï¼Œå°†æ–‡æœ¬ã€è§†è§‰è¯­ä¹‰ token å’Œå›¾åƒ VAE token åœ¨åºåˆ—çº§åˆ«è¿›è¡Œæ‹¼æ¥ï¼Œä½œä¸ºç»Ÿä¸€çš„è¾“å…¥æµï¼Œæœ€å¤§åŒ–å‚æ•°æ•ˆç‡ã€‚

**æ¨¡å‹å˜ä½“**ï¼š
- ğŸš€ **Z-Image-Turbo** â€“ è’¸é¦ç‰ˆæœ¬ï¼Œä»…éœ€ **8 NFEs**ï¼ˆå‡½æ•°è¯„ä¼°æ¬¡æ•°ï¼‰å³å¯è¾¾åˆ°æˆ–è¶…è¶Šé¢†å…ˆç«äº‰å¯¹æ‰‹ã€‚åœ¨ä¼ä¸šçº§ H800 GPU ä¸Šå¯å®ç°**äºšç§’çº§æ¨ç†å»¶è¿Ÿ**ï¼Œå¹¶å¯åœ¨ **16GB æ˜¾å­˜çš„æ¶ˆè´¹çº§è®¾å¤‡**ä¸Šè¿è¡Œã€‚
- ğŸ§± **Z-Image-Base** â€“ éè’¸é¦åŸºç¡€æ¨¡å‹ï¼Œç”¨äºç¤¾åŒºé©±åŠ¨çš„å¾®è°ƒå’Œè‡ªå®šä¹‰å¼€å‘ã€‚
- âœï¸ **Z-Image-Edit** â€“ é’ˆå¯¹å›¾åƒç¼–è¾‘ä»»åŠ¡å¾®è°ƒçš„å˜ä½“ï¼Œå…·æœ‰å‡ºè‰²çš„æŒ‡ä»¤éµå¾ªèƒ½åŠ›ã€‚

**æ¨¡å‹äº®ç‚¹**ï¼š
- **ç…§ç‰‡çº§çœŸå®è´¨é‡**ï¼šåœ¨ä¿æŒå‡ºè‰²ç¾å­¦è´¨é‡çš„åŒæ—¶ï¼Œæä¾›å¼ºå¤§çš„ç…§ç‰‡çº§çœŸå®å›¾åƒç”Ÿæˆ
- **ç²¾å‡†çš„åŒè¯­æ–‡æœ¬æ¸²æŸ“**ï¼šæ“…é•¿å‡†ç¡®æ¸²æŸ“å¤æ‚çš„ä¸­è‹±æ–‡æ–‡æœ¬
- **æç¤ºè¯å¢å¼ºä¸æ¨ç†**ï¼šæç¤ºè¯å¢å¼ºå™¨èµ‹äºˆæ¨¡å‹æ¨ç†èƒ½åŠ›
- **äºšç§’çº§æ¨ç†**ï¼šåœ¨æ”¯æŒçš„ç¡¬ä»¶ä¸Šå®ç°å¿«é€Ÿç”Ÿæˆ

**ç›¸å…³é“¾æ¥**ï¼š
- [GitHub](https://github.com/Tongyi-MAI/Z-Image)
- [Hugging Face](https://huggingface.co/Tongyi-MAI/Z-Image-Turbo)
- [é­”æ­ ModelScope](https://www.modelscope.cn/models/Tongyi-MAI/Z-Image-Turbo)
- [åœ¨çº¿æ¼”ç¤º (HuggingFace)](https://huggingface.co/spaces/Tongyi-MAI/Z-Image-Turbo)
- [åœ¨çº¿æ¼”ç¤º (é­”æ­)](https://www.modelscope.cn/aigc/imageGeneration?tab=advanced&versionId=469191&modelType=Checkpoint&sdVersion=Z_IMAGE_TURBO)

## Z-Image-Turbo æ–‡ç”Ÿå›¾å·¥ä½œæµ

<UpdateReminder />

### 1. ä»æºç å®‰è£… diffusers

Z-Image æ”¯æŒå·²åˆå¹¶åˆ°æœ€æ–°çš„ diffusers ç‰ˆæœ¬ä¸­ã€‚ä½ éœ€è¦ä»æºç å®‰è£… diffusersï¼š

```bash
pip install git+https://github.com/huggingface/diffusers
```

### 2. æ¨¡å‹ä¸‹è½½

ä» Hugging Face ä¸‹è½½æ¨¡å‹ï¼š

```bash
pip install -U huggingface_hub
HF_XET_HIGH_PERFORMANCE=1 hf download Tongyi-MAI/Z-Image-Turbo
```

å›½å†…ç”¨æˆ·ä¹Ÿå¯ä»¥ä»é­”æ­ ModelScope ä¸‹è½½ã€‚

### 3. å¿«é€Ÿå¼€å§‹ä»£ç 

```python
import torch
from diffusers import ZImagePipeline

# 1. åŠ è½½ pipeline
# åœ¨æ”¯æŒçš„ GPU ä¸Šä½¿ç”¨ bfloat16 ä»¥è·å¾—æœ€ä½³æ€§èƒ½
pipe = ZImagePipeline.from_pretrained(
    "Tongyi-MAI/Z-Image-Turbo",
    torch_dtype=torch.bfloat16,
    low_cpu_mem_usage=False,
)
pipe.to("cuda")

# [å¯é€‰] æ³¨æ„åŠ›åç«¯
# Diffusers é»˜è®¤ä½¿ç”¨ SDPAã€‚å¦‚æœæ”¯æŒï¼Œå¯åˆ‡æ¢åˆ° Flash Attention ä»¥è·å¾—æ›´å¥½çš„æ•ˆç‡ï¼š
# pipe.transformer.set_attention_backend("flash")    # å¯ç”¨ Flash-Attention-2
# pipe.transformer.set_attention_backend("_flash_3") # å¯ç”¨ Flash-Attention-3

# [å¯é€‰] æ¨¡å‹ç¼–è¯‘
# ç¼–è¯‘ DiT æ¨¡å‹å¯åŠ é€Ÿæ¨ç†ï¼Œä½†é¦–æ¬¡è¿è¡Œéœ€è¦æ›´é•¿çš„ç¼–è¯‘æ—¶é—´ã€‚
# pipe.transformer.compile()

# [å¯é€‰] CPU å¸è½½
# ä¸ºå†…å­˜å—é™çš„è®¾å¤‡å¯ç”¨ CPU å¸è½½ã€‚
# pipe.enable_model_cpu_offload()

prompt = "Young Chinese woman in red Hanfu, intricate embroidery. Impeccable makeup, red floral forehead pattern. Elaborate high bun, golden phoenix headdress, red flowers, beads. Holds round folding fan with lady, trees, bird. Neon lightning-bolt lamp (âš¡ï¸), bright yellow glow, above extended left palm. Soft-lit outdoor night background, silhouetted tiered pagoda (è¥¿å®‰å¤§é›å¡”), blurred colorful distant lights."

# 2. ç”Ÿæˆå›¾åƒ
image = pipe(
    prompt=prompt,
    height=1024,
    width=1024,
    num_inference_steps=9,  # å®é™…ä¸Šä¼šè¿›è¡Œ 8 æ¬¡ DiT å‰å‘ä¼ æ’­
    guidance_scale=0.0,     # Turbo æ¨¡å‹çš„ guidance åº”è®¾ä¸º 0
    generator=torch.Generator("cuda").manual_seed(42),
).images[0]

image.save("example.png")
```

### 4. å…³é”®å‚æ•°

| å‚æ•° | æ¨èå€¼ | è¯´æ˜ |
| --- | ----- | --- |
| `num_inference_steps` | 9 | å®é™…è¿›è¡Œ 8 æ¬¡ DiT å‰å‘ä¼ æ’­ |
| `guidance_scale` | 0.0 | Turbo æ¨¡å‹åº”è®¾ä¸º 0 |
| `torch_dtype` | `torch.bfloat16` | åœ¨æ”¯æŒçš„ GPU ä¸Šè·å¾—æœ€ä½³æ€§èƒ½ |

### 5. æ€§èƒ½ä¼˜åŒ–

**æ³¨æ„åŠ›åç«¯**

åˆ‡æ¢åˆ° Flash Attention ä»¥è·å¾—æ›´å¥½çš„æ•ˆç‡ï¼š
```python
pipe.transformer.set_attention_backend("flash")    # Flash-Attention-2
pipe.transformer.set_attention_backend("_flash_3") # Flash-Attention-3
```

**æ¨¡å‹ç¼–è¯‘**

ç¼–è¯‘ DiT æ¨¡å‹ä»¥åŠ é€Ÿæ¨ç†ï¼ˆé¦–æ¬¡è¿è¡Œä¼šè¾ƒæ…¢ï¼‰ï¼š
```python
pipe.transformer.compile()
```

**CPU å¸è½½**

å¯¹äºå†…å­˜å—é™çš„è®¾å¤‡ï¼š
```python
pipe.enable_model_cpu_offload()
```

## å¼•ç”¨

å¦‚æœä½ åœ¨ç ”ç©¶ä¸­å‘ç° Z-Image æœ‰ç”¨ï¼Œè¯·è€ƒè™‘å¼•ç”¨ï¼š

```bibtex
@misc{z-image-2025,
  title={Z-Image: An Efficient Image Generation Foundation Model with Single-Stream Diffusion Transformer},
  author={Tongyi Lab},
  year={2025},
  publisher={GitHub},
  journal={GitHub repository},
  howpublished={\url{https://github.com/Tongyi-MAI/Z-Image}}
}
```
